#! /bin/sh
set -e
export LC_ALL=C TERM="xterm"
set -x
env > /etc/envvars

temp_var=$@

run_command () {
   if [ -x $1 ]; then
        echo >&2 "*** Running: $1"
        $1
        retval=$?
        if [ $retval != 0 ];
        then
            echo >&2 "*** Failed with return value: $?"
            exit $retval
        fi
    fi
}

run_startup_files() {
   #running /etc/my_init.d/
   echo "Starting pre-service scritps in /etc/my_init.d"
   for script in /etc/my_init.d/*
    do
     run_command $script
   done

   # running /etc/rc.local 
   run_command /etc/rc.local
}

start_runit () {
   echo "Booting runit daemon..."
   exec /sbin/runsvdir -P /etc/service
}

shutdown_runit_services() {
   echo "Begin shutting down runit services..."
   /sbin/sv down /etc/service/*
}

#condition for --skip-startup-files
if ! [ `echo $temp_var | grep -c "\-\-skip-startup-files" ` -gt 0 ] ; then
   run_startup_files
 else
   temp_var=$(echo $temp_var|sed "s/--skip-startup-files//")
fi

#condition for --skip-runit
if ! [ `echo $temp_var | grep -c "\-\-skip-runit" ` -gt 0 ] ; then
   start_runit
  else 
   temp_var=$(echo $temp_var|sed "s/--skip-runit//")
   temp_var=$(echo $temp_var|sed "s/--//")
   if ! [ "$temp_var" == "" ] ; then 
     exec $temp_var
   else
    echo "need to add command to do something"
   fi
fi
