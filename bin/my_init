#! /bin/sh
set -e
export LC_ALL=C TERM="xterm"
set -x
env > /etc/envvars

run_command () {
   if [ -x $1 ]; then
        echo >&2 "*** Running: $1"
        $1
        retval=$?
        if [ $retval != 0 ];
        then
            echo >&2 "*** Failed with return value: $?"
            exit $retval
        fi
    fi
}

run_startup_files() {
   #running /etc/my_init.d/
   echo "Starting pre-service scritps in /etc/my_init.d"
   for script in /etc/my_init.d/*
    do
     run_command $script
   done

   # running /etc/rc.local 
   run_command /etc/rc.local
}

#condition for --skip-startup-files
if ![ `echo $@ | grep -c "--skip-startup-files" ` -gt 0 ] ; then
 run_startup_files
fi

if [ $# -eq 0 ]; then
    exec /sbin/runsvdir -P /etc/service
fi
/sbin/runsvdir -P /etc/service &

[ "$1" == '--' ] && shift
exec $@
